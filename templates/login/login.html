{% load static %}
<!doctype html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<link rel="icon" href="{% static 'favicon.ico' %}" type="image/ico">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>登录</title>
<link rel="stylesheet" type="text/css" href="{% static 'login/css/styles.css' %}">
</head>
<body>
<div class="htmleaf-container">
	<div class="wrapper">
        <div class="container">
            {% if msg %}
			<h2>{{ msg }}</h2>
            {% else %}
            <h1 id="biaoti">Welcome</h1>
            {% endif %}
			<form class="form" action="/login/" method="post">
                {%  csrf_token %}
				<input type="text" name="username" placeholder="用户名">
				<input type="password" name= 'password' placeholder="密码">
				<button type="submit" id="login-button">Login</button>
{#                <input type="submit" value="登入">#}
			</form>
		</div>
		
		<ul class="bg-bubbles">
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
		</ul>
	</div>
</div>

<script src="{% static 'login/js/jquery-2.1.1.min.js' %}" type="text/javascript"></script>
<script>
$('#login-button').click(function (event) {
	event.preventDefault();

    let sAccount = $('input[name="username"]').val();
    if (sAccount === ''){
        $('#biaoti').text('用户名不能为空');
        return
    }
    // 2.校验用户输入密码
    let sPassword = $('input[name="password"]').val();
    if(sPassword === ''){
        $('#biaoti').text('密码不能为空');
        return
    }
    // 4.发送ajax
    $.ajax({
        url: '/user/login/',
        data: {
            account: sAccount,
            password: sPassword,
        },
        type: 'POST',
        dataType: 'json',
        success: function (res) {
            if(res.errno === '0'){
                $('form').fadeOut(500);
                message.showSuccess('恭喜， 登录成功！');
                setTimeout(function () {
                    //注册成功之后重定向到打开登录页面之前的页面
                    //重定向
                    if(!document.referrer || document.referrer.includes('/user/login/') || document.referrer.includes('/user/register/')){
                        window.location.href = '/'
                    }else {
                        window.location.href = document.referrer
                    }
                }, 1000)
            }else{
                message.showError(res.errmsg)
            }
        },
        error: function (xhr, msg) {
            message.showError('服务器超时，请重试')

        }
    });


});


</script>

<div style="text-align:center;margin:50px 0; font:normal 14px/24px 'MicroSoft YaHei';color:#000000">
<h1>暂未开放</h1>
</div>
</body>
</html>
